<div class="ai-details-container">
  <!-- Header Section -->
  <div class="details-header fade-in">
    <div class="header-content">
      <h1 class="page-title ai-gradient">
        <svg class="title-icon" width="28" height="28" viewBox="0 0 24 24" fill="none">
          <path d="M3 3H21C21.6 3 22 3.4 22 4V20C22 20.6 21.6 21 21 21H3C2.4 21 2 20.6 2 20V4C2 3.4 2.4 3 3 3Z" stroke="currentColor" stroke-width="2"/>
          <path d="M8 12H16" stroke="currentColor" stroke-width="2"/>
          <path d="M8 16H13" stroke="currentColor" stroke-width="2"/>
          <path d="M8 8H16" stroke="currentColor" stroke-width="2"/>
        </svg>
        Transaction Details
      </h1>
      <p class="page-subtitle">Monitor and analyze transaction flows</p>
    </div>
  </div>

  <!-- Loading State -->
  <app-loader [isLoading]="isLoading"></app-loader>

  <!-- Main Content -->
  <div class="details-content" *ngIf="!isLoading">
    <!-- Controls Panel -->
    <div class="controls-panel glass-effect slide-in">
      <div class="controls-grid">
        <!-- Search Control -->
        <div class="control-item">
          <label class="control-label">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
              <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2"/>
            </svg>
            Search Transactions
          </label>
          <div class="search-wrapper">
            <input #InputVar 
                   type="text" 
                   class="ai-search-input" 
                   placeholder="Search by any field..." 
                   (input)="onSearch($event)" />
            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
              <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
        </div>

        <!-- Client Selection -->
        <div class="control-item">
          <label class="control-label">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M20 21V19C20 17.9 19.1 17 18 17H6C4.9 17 4 17.9 4 19V21" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            </svg>
            Client
          </label>
          <select [(ngModel)]="selectedClient" 
                  class="ai-select" 
                  (ngModelChange)="onClientChange($event)">
            <option value="" disabled>Select a client</option>
            <option *ngFor="let client of clientOptions" [value]="client">{{ client }}</option>
          </select>
        </div>

        <!-- Date Range -->
        <div class="control-item date-control">
          <label class="control-label">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
              <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
              <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
              <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
            </svg>
            Date Range
          </label>
          <div class="date-range-container">
            <mat-form-field class="ai-form-field">
              <mat-date-range-input [rangePicker]="picker" [formGroup]="dateRange" [max]="currentDate">
                <input matStartDate placeholder="Start date" formControlName="start" (dateInput)="handleDateChange()" required>
                <input matEndDate placeholder="End date" formControlName="end" (dateInput)="handleDateChange()" required>
              </mat-date-range-input>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
            <button *ngIf="dateRange.value.start || dateRange.value.end"
                    class="clear-date-btn hover-glow" 
                    (click)="clearDate()" 
                    matTooltip="Clear Date Range">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2"/>
                <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="control-item actions">
          <div class="action-buttons">
            <button class="action-btn hover-glow" matTooltip="Clear Filters" (click)="reset()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M3 6H21" stroke="currentColor" stroke-width="2"/>
                <path d="M19 6V20C19 21 18 22 17 22H7C6 22 5 21 5 20V6" stroke="currentColor" stroke-width="2"/>
                <path d="M8 6V4C8 3 9 2 10 2H14C15 2 16 3 16 4V6" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            <button class="action-btn hover-glow" matTooltip="Refresh Data" (click)="refresh()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <polyline points="23 4 23 10 17 10" stroke="currentColor" stroke-width="2"/>
                <polyline points="1 20 1 14 7 14" stroke="currentColor" stroke-width="2"/>
                <path d="M20.49 9C19.9 5.5 16.9 3 13.5 3C9.8 3 6.8 5.4 6.2 8.5" stroke="currentColor" stroke-width="2"/>
                <path d="M3.51 15C4.1 18.5 7.1 21 10.5 21C14.2 21 17.2 18.6 17.8 15.5" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Grid -->
    <div class="grid-container ai-card fade-in">
      <div class="grid-header">
        <h3 class="grid-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M3 3H21C21.6 3 22 3.4 22 4V20C22 20.6 21.6 21 21 21H3C2.4 21 2 20.6 2 20V4C2 3.4 2.4 3 3 3Z" stroke="currentColor" stroke-width="2"/>
            <path d="M9 9H15" stroke="currentColor" stroke-width="2"/>
            <path d="M9 15H15" stroke="currentColor" stroke-width="2"/>
          </svg>
          Transaction Data
        </h3>
        <div class="grid-stats">
          <span class="stat-item">
            <span class="stat-value">{{filteredRowData.length}}</span>
            <span class="stat-label">Records</span>
          </span>
        </div>
      </div>
      
      <div class="ag-grid-wrapper">
        <ag-grid-angular 
          class="ag-theme-quartz ai-grid" 
          [columnDefs]="columnDefs" 
          [rowData]="filteredRowData"
          [defaultColDef]="defaultColDef" 
          [gridOptions]="gridOptions"
          [overlayNoRowsTemplate]="noRowsTemplate" 
          (gridReady)="onGridReady($event)">
        </ag-grid-angular>
      </div>
    </div>
  </div>
</div>