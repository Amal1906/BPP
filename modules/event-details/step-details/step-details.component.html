<div class="ai-step-details-container">
  <!-- Header Section -->
  <div class="step-details-header fade-in">
    <div class="header-actions">
      <button class="nav-btn hover-glow" (click)="navigateBack()" matTooltip="Back to Details">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M19 12H5" stroke="currentColor" stroke-width="2"/>
          <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
      <button class="nav-btn hover-glow" (click)="onRefresh()" matTooltip="Refresh Data">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <polyline points="23 4 23 10 17 10" stroke="currentColor" stroke-width="2"/>
          <polyline points="1 20 1 14 7 14" stroke="currentColor" stroke-width="2"/>
          <path d="M20.49 9C19.9 5.5 16.9 3 13.5 3C9.8 3 6.8 5.4 6.2 8.5" stroke="currentColor" stroke-width="2"/>
          <path d="M3.51 15C4.1 18.5 7.1 21 10.5 21C14.2 21 17.2 18.6 17.8 15.5" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
    
    <div class="header-content">
      <h1 class="page-title ai-gradient">
        <svg class="title-icon" width="28" height="28" viewBox="0 0 24 24" fill="none">
          <path d="M22 12H18L15 21L9 3L6 12H2" stroke="currentColor" stroke-width="2"/>
        </svg>
        Process Step Details
      </h1>
      <p class="page-subtitle">Track individual process execution steps</p>
    </div>
  </div>

  <!-- Loading State -->
  <app-loader [isLoading]="isLoading"></app-loader>

  <!-- Stepper Component -->
  <div class="stepper-section" *ngIf="!isLoading && workFlow.length > 0">
    <app-stepper [workFlow]="workFlow" [loading]="isLoading"></app-stepper>
  </div>

  <!-- Steps Table -->
  <div class="steps-container" *ngIf="!isLoading">
    <div class="steps-card ai-card fade-in">
      <div class="card-header">
        <h3 class="card-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2"/>
            <path d="M21 12C21 16.9 16.9 21 12 21S3 16.9 3 12S7.1 3 12 3S21 7.1 21 12Z" stroke="currentColor" stroke-width="2"/>
          </svg>
          Execution Steps
        </h3>
        <div class="step-stats">
          <span class="stat-item">
            <span class="stat-value">{{steps?.length || 0}}</span>
            <span class="stat-label">Steps</span>
          </span>
        </div>
      </div>

      <div class="table-container">
        <div class="table-wrapper">
          <table class="ai-table">
            <thead>
              <tr>
                <th>
                  <div class="th-content">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M9 11H15" stroke="currentColor" stroke-width="2"/>
                      <path d="M9 15H15" stroke="currentColor" stroke-width="2"/>
                      <path d="M17 3V21L12 18L7 21V3H17Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Step Name
                  </div>
                </th>
                <th>
                  <div class="th-content">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Process Time
                  </div>
                </th>
                <th>
                  <div class="th-content">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M22 11.08V12C22 17.5 17.5 22 12 22S2 17.5 2 12S6.5 2 12 2C14.25 2 16.28 2.94 17.72 4.38" stroke="currentColor" stroke-width="2"/>
                      <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Status
                  </div>
                </th>
                <th>
                  <div class="th-content">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M21 15C21 15.5 20.5 16 20 16H4C3.5 16 3 15.5 3 15V9C3 8.5 3.5 8 4 8H20C20.5 8 21 8.5 21 9V15Z" stroke="currentColor" stroke-width="2"/>
                      <path d="M7 12H17" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Comments
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let step of steps; let i = index" 
                  class="table-row"
                  [style.animation-delay]="(i * 0.1) + 's'">
                <td class="step-name-cell">
                  <div class="step-name-content">
                    <div class="step-indicator" [ngClass]="getStatusBadge(step.step_status).statusClass"></div>
                    {{ step.step_name || '-' }}
                  </div>
                </td>
                <td class="time-cell">
                  <div class="time-content">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{ step.process_time ? (step.process_time | formatDateTime : "MM-dd-yyyy, HH:mm:ss") : "-" }}
                  </div>
                </td>
                <td class="status-cell">
                  <div class="content-badge"
                       [ngClass]="getStatusBadge(step.step_status).statusClass">
                    <div class="status-dot"></div>
                    {{ getStatusBadge(step.step_status).statusText }}
                  </div>
                </td>
                <td class="comments-cell">
                  <div class="comments-content" [title]="step.comments || '-'">
                    {{ step.comments || '-' }}
                  </div>
                </td>
              </tr>
              <tr *ngIf="steps.length === 0" class="empty-row">
                <td colspan="4" class="empty-cell">
                  <div class="empty-state">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <path d="M8 12H16" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <p>No steps available</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>