<div class="container modern-dashboard">
  <div class="loader-content">
    <div class="filters mb-5">
      <form class="row g-3 align-items-center justify-content-between">
        
        <!-- Client Selection Dropdown - Left Side -->
        <div class="col-auto">
          <mat-form-field appearance="outline" class="client-dropdown-modern">
            <mat-label>Select Broker/Agency</mat-label>
            <mat-select 
              [(value)]="selectedProject" 
              panelClass="client-select-panel" 
              (selectionChange)="onClientChange()">
              
              <mat-option *ngFor="let project of projects" [value]="project">
                <mat-icon class="client-icon">business</mat-icon>
                {{ clientDisplayNames[project] }}
              </mat-option>
              
            </mat-select>
            <mat-icon matSuffix class="dropdown-icon">account_balance</mat-icon>
          </mat-form-field>
        </div>


        <!-- Date Filter - Right Side -->
        <div class="col-auto align-items-center d-flex">
          <!-- <div *ngIf="startDateCtrl.value || endDateCtrl.value" class="me-2" matTooltip="Clear" style="cursor: pointer;"
            (click)="clearDateRange()" title="Clear Date Range">
            <span class="task-filter-modern">
              <mat-icon>clear</mat-icon>
            </span>
          </div> -->
          
          <mat-form-field class="w-100 date-picker-modern">
            <mat-label>Select a date range</mat-label>
            <mat-date-range-input [rangePicker]="picker" [max]="maxDate">
              <input matStartDate [formControl]="startDateCtrl" placeholder="Start date" readonly>
              <input matEndDate [formControl]="endDateCtrl" placeholder="End date" readonly>
            </mat-date-range-input>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker (closed)="fetchDashboardData()" disabled="false"></mat-date-range-picker>
            <mat-error *ngIf="isInvalidDateRange">
              Both start and end dates are required.
            </mat-error>
          </mat-form-field>
        </div>
      </form>
    </div>

    <div class="divider-modern"></div>

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="text-center my-4">
      <mat-spinner class="modern-spinner"></mat-spinner>
      <p class="loading-text">Loading dashboard data...</p>
    </div>

    <!-- Dashboard Tiles -->
    <div class="dashboard-modern" *ngIf="!loading">
      <mat-grid-list [cols]="gridCols" rowHeight="180px" gutterSize="20px">

        <mat-grid-tile>
          <mat-card class="dashboard-tile modern-card" (click)="goToDetails('Received')" style="cursor: pointer;">
            <mat-card-title>
              <div class="tile-header">
                <div class="tile-icon received-icon">
                  <mat-icon>inbox</mat-icon>
                </div>
                <div class="tile-title">
                  <h3>Received</h3>
                  <p class="tile-description">Transactions received for processing</p>
                </div>
              </div>
            </mat-card-title>
            <mat-card-content class="tile-content">
              <div class="tile-count">{{receivedCount}}</div>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-card class="dashboard-tile modern-card" (click)="goToDetails('Policy_Checking')" style="cursor: pointer;">
            <mat-card-title>
              <div class="tile-header">
                <div class="tile-icon policy-icon">
                  <mat-icon>fact_check</mat-icon>
                </div>
                <div class="tile-title">
                  <h3>Policy Checking</h3>
                  <p class="tile-description">Automated policy comparison</p>
                </div>
              </div>
            </mat-card-title>
            <mat-card-content class="tile-content">
              <div class="tile-count">{{policyCheckCount}}</div>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-card class="dashboard-tile modern-card" (click)="goToDetails('COI')" style="cursor: pointer;">
            <mat-card-title>
              <div class="tile-header">
                <div class="tile-icon coi-icon">
                  <mat-icon>description</mat-icon>
                </div>
                <div class="tile-title">
                  <h3>COI</h3>
                  <p class="tile-description">Certificate of insurance processing and issuance</p>
                </div>
              </div>
            </mat-card-title>
            <mat-card-content class="tile-content">
              <div class="tile-count">{{coiCount}}</div>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-card class="dashboard-tile modern-card" (click)="goToDetails('Carrier_Download')" style="cursor: pointer;">
            <mat-card-title>
              <div class="tile-header">
                <div class="tile-icon carrier-icon">
                  <mat-icon>cloud_download</mat-icon>
                </div>
                <div class="tile-title">
                  <h3>Carrier Downloads</h3>
                  <p class="tile-description">Automated carrier documents retrieval</p>
                </div>
              </div>
            </mat-card-title>
            <mat-card-content class="tile-content">
              <div class="tile-count">{{carrierDownload}}</div>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>

        <mat-grid-tile>
          <mat-card class="dashboard-tile modern-card" (click)="goToDetails('New_Renewal')" style="cursor: pointer;">
            <mat-card-title>
              <div class="tile-header">
                <div class="tile-icon renewal-icon">
                  <mat-icon>autorenew</mat-icon>
                </div>
                <div class="tile-title">
                  <h3>Policy Renewal</h3>
                  <p class="tile-description">Policy renewal processing</p>
                </div>
              </div>
            </mat-card-title>
            <mat-card-content class="tile-content">
              <div class="tile-count">{{newRenewalCount}}</div>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>

      </mat-grid-list>
    </div>
  </div>
</div>
